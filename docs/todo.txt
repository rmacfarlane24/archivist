\n# Performance/UX: Large directory scrolling
- [ ] Polish large-directory scrolling and rendering
  - [ ] Finalize true virtualization of child lists (react-virtuoso):
    - [ ] Compute dynamic container height (measure header/toolbars); avoid hard-coded calc()
    - [ ] Provide stable row keys (computeItemKey) to prevent re-mounts
    - [ ] Tune overscan based on scroll velocity and device pixel ratio
  - [ ] Smooth pagination:
    - [ ] Preemptive multi-page prefetch with time-sliced updates (startTransition)
    - [ ] Remove sentinel flicker; use invisible intersection sentinels only
    - [ ] Ensure no duplicate loader rows; consolidate merges per parentPath
  - [ ] UX polish:
    - [ ] Minimal inline loading skeleton for rows (no layout jump)
    - [ ] Preserve expand state and scroll position across updates
  - [ ] Perf targets: first expand < 50ms, sustained scroll < 16ms/frame, memory stable
  - [ ] Add profiling traces (Chrome devtools + perf marks) on large demo dataset (300k+ entries)


TODO LIST FOR ELECTRON APP SHIPPING
=====================================


1. FIX NODE_ENV FOR PRODUCTION
   - Update package.json build scripts to set NODE_ENV=production
   - Modify main.ts to handle production mode properly (load from dist folder instead of localhost)
   - Test that production build loads static files correctly

2. BUILD CONFIGURATION
   - Ensure vite.config.ts is optimized for production builds
   - Verify build output goes to correct directory (app/dist)
   - Test that all assets are properly included in build

3. ELECTRON BUILDER CONFIGURATION
   - Review electron-builder configuration in package.json
   - Ensure all necessary files are included in build
   - Test packaging on target platforms (macOS, Windows, Linux)
   - Verify JSON storage files are properly bundled

4. STORAGE HANDLING
   - Ensure storage path works in production (userData directory)
   - Test JSON storage initialization in packaged app
   - Verify file operations work correctly in production

5. ASSET MANAGEMENT
   - Add app icon for production builds
   - Ensure all static assets are properly referenced
   - Test that images and other resources load correctly

6. SECURITY & PERMISSIONS
   - Review file system access permissions
   - Ensure folder picker dialog works in production
   - Test file scanning functionality in packaged app

7. ERROR HANDLING
   - Add proper error handling for production environment
   - Test error scenarios (missing files, permission denied, etc.)
   - Add user-friendly error messages

8. PERFORMANCE OPTIMIZATION
   - Optimize bundle size for production
   - Test app startup time
   - Verify memory usage is reasonable
   - Test JSON storage performance with large datasets

9. TESTING
   - Test full workflow in packaged app
   - Verify all IPC communication works
   - Test JSON storage operations end-to-end
   - Test folder scanning and metadata storage
   - Test memory cache functionality

10. DOCUMENTATION
    - Create user documentation
    - Add installation instructions
    - Document any system requirements
    - Document new JSON storage system

11. DISTRIBUTION
    - Create installer packages for each platform
    - Test installation process
    - Verify app launches correctly after installation

12. MIGRATION FROM OLD SQLITE DATA (OPTIONAL)
    - Create migration script to convert existing SQLite data to JSON
    - Test migration process
    - Add user notification about data migration

13. SESSION DURATION MANAGEMENT FOR TRIAL ABUSE PROTECTION
    - Implement session duration limits to prevent free trial abuse:
      * Change default session duration from 1 year to 30 days for offline usage
      * Add trial-specific session management for 14-day free trial users
      * Implement last internet connection tracking for all users
      * Add automatic logout after 30 days without internet connection
    - Trial-specific features:
      * 14-day trial users: Force re-authentication after trial expires
      * Trial users: Prevent offline usage beyond trial period
      * Trial users: Add trial expiration warnings and countdown
      * Trial users: Implement trial extension requests
    - Session management implementation:
      * Add last_online_timestamp to user profiles table
      * Implement periodic online status checks (when internet available)
      * Add session expiration warnings in the UI
      * Create graceful logout flow with data preservation
      * Add offline usage time tracking and limits
    - User experience considerations:
      * Clear messaging about session duration limits
      * Graceful degradation when approaching limits
      * Option to upgrade to paid plan for extended offline usage
      * Preserve local data even after session expiration
      * Add "Go Online" prompts when approaching limits
    - Security and abuse prevention:
      * Prevent trial users from bypassing session limits
      * Implement server-side session validation
      * Add rate limiting for authentication attempts
      * Track and prevent multiple trial account creation
      * Add IP-based trial abuse detection
    - Database schema updates:
      * Add last_online_timestamp column to profiles table
      * Add trial_expires_at column for trial users
      * Add session_duration_limit column for different user types
      * Add offline_usage_tracking table for detailed monitoring
    - Implementation phases:
      * Phase 1: Basic session duration limits (30 days offline max)
      * Phase 2: Trial-specific session management
      * Phase 3: Advanced abuse prevention and monitoring
      * Phase 4: User experience improvements and messaging

14. REMOVE ANONYMOUS STORAGE BEFORE PRODUCTION
    - Remove anonymous catalog.db creation during app startup
    - Modify main.ts to not initialize storage manager until user signs in
    - Update storage switching logic to handle null storage manager state
    - Test that user-specific storage isolation still works correctly
    - Clean up any orphaned anonymous storage files in existing installations
    - Update documentation to reflect production storage behavior

Search Navigation Improvements (toward ideal flow)
-------------------------------------------------
- [x] Convert implicit timeouts to explicit staged navigation (finalizing timeout removed; token-guarded finalize)
- [x] Introduce explicit navigation token with cancellation of pending async steps
- [x] Use a consistent scroll API: use container ref / window fallback with `scrollIntoView`
- [ ] Add focus management on selection (move focus to row, maintain tab order)
- [ ] Add ARIA live announcements for navigation status
- [x] Make ancestor expansion drive-root aware (no hardcoded '/Volumes')
- [x] Persist expanded folders per drive only (remove legacy global key)
- [x] Drive selection by id only (remove name fallback)
- [ ] Handle hidden/system filters by temporarily revealing target ancestors
- [ ] Improve missing/renamed/deleted file handling with actionable prompts
- [ ] Add tests: ancestor derivation, batch hydration merge, scroll behavior under virtualization
- [ ] Observability: per-stage timings, error reasons, and counters in logs

UI Improvements
---------------
- [x] Add total file count to the drive info display (show estimated file count alongside capacity/usage info)
- [x] Fix progress bar UI race condition (drive info now populates correctly before scan starts)
- [x] Implement scan cancellation with confirmation dialog
- [x] Remove soft-delete functionality (now hard-delete only)
- [x] Clean up progress UI styling (remove colors, icons, gradients)
- [x] Fix drive info population timing in "Add New Drive" modal
- [ ] Implement batch loading for multiple parent paths (replaced listChildrenBatch with individual calls)
- [ ] Add better error handling for scan start failures
- [ ] Verify automatic drive selection after scan completion
- [ ] Test full scan progress flow with new timing
- [ ] Handle scan failures with automatic backup restoration (currently only cancellation is handled automatically)

Accessibility Improvements (Required Before Launch)
-------------------------------------------------
See [ACCESSIBILITY.md](ACCESSIBILITY.md) for detailed requirements and implementation guide.

- [ ] Quick Wins (1-2 hours total):
  - [ ] Add aria-label to icon-only buttons
  - [ ] Add proper heading structure (h1, h2, h3)
  - [ ] Add aria-hidden to decorative SVG icons
- [ ] Medium Effort (Half day):
  - [ ] Add aria-live regions for dynamic content
  - [ ] Implement focus trap for modals
  - [ ] Add aria-describedby for form validation
- [ ] Testing & Verification:
  - [ ] Manual keyboard navigation test
  - [ ] Screen reader testing (VoiceOver)
  - [ ] Browser accessibility audit

Payment Integration & Subscription System
----------------------------------------
- [ ] PREP FOR BETA TESTING (Current Phase):
  - [ ] Build subscription plans UI components
  - [ ] Add trial status tracking and countdown
  - [ ] Create plan selection modals
  - [ ] Integrate subscription status with existing Account page
  - [ ] Add trial expiration warnings and upgrade prompts
  - [ ] Test trial flow with mock data

- [ ] STRIPE INTEGRATION (After website launch):
  - [ ] Set up Stripe account and business verification
  - [ ] Create products and pricing plans in Stripe Dashboard
  - [ ] Get API keys (publishable and secret)
  - [ ] Set up webhook endpoints for subscription events
  - [ ] Implement backend API endpoints:
    - [ ] POST /api/subscriptions/create
    - [ ] POST /api/stripe/webhook
    - [ ] GET /api/subscriptions/status
  - [ ] Add subscription database schema:
    - [ ] Add subscription fields to user profiles
    - [ ] Create subscriptions table for tracking
  - [ ] Integrate Stripe Checkout for payment flow
  - [ ] Handle webhook events (subscription created/updated/cancelled)
  - [ ] Test complete payment flow with Stripe test mode

- [ ] STRIKE BITCOIN LIGHTNING INTEGRATION (Future):
  - [ ] Research Strike API documentation
  - [ ] Set up Strike developer account
  - [ ] Implement Bitcoin Lightning payment flow
  - [ ] Add Strike as alternative payment option
  - [ ] Handle cross-currency subscription management

- [ ] SUBSCRIPTION MANAGEMENT FEATURES:
  - [ ] Plan upgrade/downgrade functionality
  - [ ] Payment method management
  - [ ] Billing history display
  - [ ] Subscription cancellation flow
  - [ ] Trial extension requests
  - [ ] Offline usage limits based on subscription tier

- [ ] TRIAL SYSTEM IMPLEMENTATION:
  - [ ] 14-day trial countdown for new users
  - [ ] Trial expiration warnings (7 days, 3 days, 1 day remaining)
  - [ ] Graceful trial expiration handling
  - [ ] Prevent trial abuse with session limits
  - [ ] Trial-to-paid conversion tracking

- [ ] ENVIRONMENT SETUP:
  - [ ] Add subscription-related environment variables
  - [ ] Create config files for different environments (dev/staging/prod)
  - [ ] Set up webhook URL configuration
  - [ ] Add payment provider API keys to secure config

- [ ] TESTING & VALIDATION:
  - [ ] Test trial flow end-to-end
  - [ ] Test subscription creation with Stripe test mode
  - [ ] Test webhook handling for all subscription events
  - [ ] Test subscription management features
  - [ ] Test trial expiration and upgrade flows
  - [ ] Load test with multiple concurrent subscriptions

DISABLE THESE FOR PRODUCTION
- Dev Tools  
Disable: Set webPreferences.devTools: false in BrowserWindow.  
Reason: Prevents users from inspecting or debugging the app.
- Refresh Shortcut (Cmd+R/Ctrl+R)  
Disable: Use globalShortcut.register('CommandOrControl+R', () => false) or before-input-event to block.  
Reason: Avoids unintended app reloads.
- Context Menu (Right-Click)  
Disable: Use webContents.on('context-menu', (e) => e.preventDefault()).  
Reason: Removes browser-like options like "Inspect" or "Reload".
- Node Integration  
Disable: Set webPreferences.nodeIntegration: false and contextIsolation: true.  
Reason: Reduces security risks in the renderer process.
- Navigation Shortcuts (Alt+Left/Alt+Right)  
Disable: Use webContents.on('before-input-event') to block Alt+Arrow keys.  
Reason: Prevents unintended navigation in single-page apps.
- Drag-and-Drop File Access  
Disable: Use window.addEventListener('dragstart', (e) => e.preventDefault()).  
Reason: Prevents unauthorized file access.
- Window Resizing/Fullscreen Shortcuts  
Disable: Set resizable: false in BrowserWindow and block F11/Cmd+Ctrl+F with globalShortcut.  
Reason: Maintains fixed UI dimensions.
- External Link Navigation  
Disable: Use webContents.on('will-navigate') to block and redirect to shell.openExternal.  
Reason: Prevents external links from loading in the app window.

Implementation Tip
Apply these conditionally in production (process.env.NODE_ENV === 'production') to preserve functionality during development. Test thoroughly with your production build (e.g., using electron-builder).

